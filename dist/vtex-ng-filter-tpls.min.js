/*! vtex-ng-filter - v0.4.2 - 2017-01-11 */
(function(){var config,moreOptionsShowFilters,openFilters,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};config={path:""},openFilters={},moreOptionsShowFilters={},angular.module("vtexNgFilter",[]).factory("Filter",function($rootScope,$location,$filter,DateTransform){var Filter;return Filter=function(){function Filter(filter){var dateGetterSetter,k,querystring,ref,v;null==filter&&(filter={}),this.setGroup=bind(this.setGroup,this),this.update=bind(this.update,this),this.clearSelection=bind(this.clearSelection,this),this.getSelectedItemsURL=bind(this.getSelectedItemsURL,this),this.getSelectedItems=bind(this.getSelectedItems,this),this.setSelectedItems=bind(this.setSelectedItems,this),this.updateSelectedCount=bind(this.updateSelectedCount,this);for(k in filter)v=filter[k],this[k]=v;querystring=$location.search(),this.useTimezoneOffset=(ref=querystring.p_f_useUserTimezone)===!1||"false"===ref?!1:!0,this.currentTimezoneOffset=function(){var offset,symbol;return offset=(new Date).getTimezoneOffset()/60,symbol=parseInt(offset)>=0?"+":"",{label:symbol+offset+"h",value:offset}}(),this.onUseTimezoneOffsetChange=function(_this){return function(){return $location.search("p_f_useUserTimezone",_this.useTimezoneOffset)}}(this),this.setGroup(),this.selectedCount=0,"date"===this.type&&(this.dateObjectCache={},dateGetterSetter=function(_this){return function(date,propertyName){var ref1;return angular.isDefined(date)?_this[propertyName]=date:null!=(ref1=_this[propertyName])?ref1:!1}}(this),this.date={},this.today=DateTransform.endOfDay(new Date,this.useTimezoneOffset),this.setDates=function(_this){return function(offsetFrom,offsetTo,currentMonth){var date;return null==offsetFrom&&(offsetFrom=0),null==offsetTo&&(offsetTo=0),null==currentMonth&&(currentMonth=!1),date=null==currentMonth||currentMonth===!1?{from:moment().add("d",offsetFrom).toDate(),to:moment().add("d",offsetTo).toDate()}:{from:moment().startOf("month").toDate(),to:moment().endOf("month").toDate()},_this.date={from:DateTransform.startOfDay(date.from,_this.useTimezoneOffset),to:DateTransform.startOfDay(date.to,_this.useTimezoneOffset)}}}(this),this.dateRangeLabel=function(_this){return function(){return _this.date.from&&_this.date.to?DateTransform.startOfDay(_this.date.from,_this.useTimezoneOffset).toString()===DateTransform.startOfDay(new Date,_this.useTimezoneOffset).toString()?$filter("translate")("listing.dates.today"):moment(_this.date.from)===DateTransform.startOfDay(moment().add("d",-1),_this.useTimezoneOffset)&&moment(_this.date.to).toISOString()===DateTransform.endOfDay(moment().add("d",-1),_this.useTimezoneOffset).toISOString()?$filter("translate")("listing.dates.yesterday"):moment(_this.date.from).isSame(moment().startOf("month").toDate())&&moment(_this.date.to).isSame(moment().endOf("month").toDate())?$filter("translate")("listing.dates.currentMonth"):DateTransform.startOfDay(_this.date.to,_this.useTimezoneOffset).toISOString()===DateTransform.startOfDay(new Date,_this.useTimezoneOffset).toISOString()?moment(_this.date.from).add("hours",moment().hours()).fromNow()+" "+$filter("translate")("listing.dates.untilToday"):moment(_this.date.from).add("hours",moment().hours()).fromNow()+" "+$filter("translate")("listing.dates.until")+" "+moment(_this.date.to).add("hours",moment().hours()).fromNow():$filter("translate")("listing.dates.noRangeSelected")}}(this)),this.updateSelectedCount()}return Filter.prototype.updateSelectedCount=function(){var i,item,j,l,lastSelectedItemIndex,len,len1,ref,ref1,selectedItemIndex;if("date"===this.type)this.selectedCount=this.date.from&&this.date.to?1:0;else if("multiple"===this.type){for(ref=this.items,i=j=0,len=ref.length;len>j;i=++j)item=ref[i],item.selected&&(lastSelectedItemIndex=i);lastSelectedItemIndex>4&&(moreOptionsShowFilters[this.rangeUrlTemplate]=!0),this.selectedCount=_.filter(this.items,function(i){return i.selected}).length}else if("single"===this.type){for(ref1=this.items,i=l=0,len1=ref1.length;len1>l;i=++l)item=ref1[i],item===this.selectedItem&&(selectedItemIndex=i);selectedItemIndex>4&&(moreOptionsShowFilters[this.rangeUrlTemplate]=!0),this.selectedCount=this.selectedItem?1:0}return this.selectedCount>0&&(openFilters[this.rangeUrlTemplate]=!0),this.selectedCountLabel=this.selectedCount?"("+this.selectedCount+")":""},Filter.prototype.setSelectedItems=function(itemsAsSearchParameter){var date,item,items,j,len,ref,ref1;if("date"===this.type)items=itemsAsSearchParameter.replace(this.name+":[","").replace("]","").split(" TO "),date={from:items[0],to:items[1]},this.date=date;else if("multiple"===this.type)for(ref=this.items,j=0,len=ref.length;len>j;j++)item=ref[j],item.selected=(ref1=item.url,indexOf.call(itemsAsSearchParameter.split(","),ref1)>=0);else"single"===this.type&&(this.selectedItem=_.find(this.items,function(i){return i.url===itemsAsSearchParameter}));return this.updateSelectedCount()},Filter.prototype.getSelectedItems=function(){var base,item,j,len,ref,results,url;if("date"===this.type)return this.date.from&&this.date.to?(url=this.name+":["+DateTransform.startOfDay(this.date.from,this.useTimezoneOffset).toISOString()+" TO "+DateTransform.endOfDay(this.date.to,this.useTimezoneOffset).toISOString()+"]",(base=this.dateObjectCache)[url]||(base[url]={name:this.dateRangeLabel(),url:url}),[this.dateObjectCache[url]]):[];if("multiple"===this.type){for(ref=this.items,results=[],j=0,len=ref.length;len>j;j++)item=ref[j],item.selected&&results.push(item);return results}return"single"===this.type?this.selectedItem?[this.selectedItem]:[]:void 0},Filter.prototype.getSelectedItemsURL=function(){var selectedArray;return selectedArray=_.map(this.getSelectedItems(),function(i){return i.url}),selectedArray.length>0?selectedArray.join(","):null},Filter.prototype.clearItem=function(itemObject){var item,j,len,ref,ref1;if("date"===(ref=this.type)||"single"===ref)return this.clearSelection();if("multiple"===this.type){for(ref1=this.items,j=0,len=ref1.length;len>j;j++)item=ref1[j],itemObject.url===item.url&&(item.selected=!1);return this.updateSelectedCount()}},Filter.prototype.clearSelection=function(){var item,j,len,ref;if("date"===this.type)this.date={};else if("multiple"===this.type)for(ref=this.items,j=0,len=ref.length;len>j;j++)item=ref[j],item.selected=!1;else"single"===this.type&&(this.selectedItem=null);return this.updateSelectedCount()},Filter.prototype.update=function(filterJSON){var item,j,len,ref,ref1,updatedItem;for(null==filterJSON&&(filterJSON=this),ref=this.items,j=0,len=ref.length;len>j;j++)item=ref[j],updatedItem=_.find(filterJSON.items,function(i){return i.name===item.name}),updatedItem&&0===(null!=(ref1=this.getSelectedItems())?ref1.length:void 0)?item.quantity=updatedItem.quantity:item.quantity=0},Filter.prototype.setGroup=function(){var ref,ref1,ref2;return"creationDate"===(ref=this.name)||"authorizedDate"===ref||"ShippingEstimatedDate"===ref||"invoicedDate"===ref?this.groupName="date":"SalesChannelName"===(ref1=this.name)||"CallCenterOperatorName"===ref1||"SellerNames"===ref1||"UtmSource"===ref1||"affiliateId"===ref1?this.groupName="channel":"StatusDescription"===(ref2=this.name)||"orderSituation"===ref2||"errorStatus"===ref2?this.groupName="status":this.groupName="other"},Filter}()}).service("DateTransform",function(){return this.startOfDay=function(dateStr,useTimezoneOffset){var date,dateInUTC,isAlreadyStartOfDay;return null==useTimezoneOffset&&(useTimezoneOffset=!0),date=new Date(dateStr),(isAlreadyStartOfDay=dateStr&&(dateStr.indexOf&&-1!==dateStr.indexOf("00:00:00.000Z")||dateStr.toISOString&&-1!==dateStr.toISOString().indexOf("00:00:00.000Z")))?date:(date.setHours(0,0,0,0),useTimezoneOffset?date:dateInUTC=new Date(date.valueOf()-6e4*date.getTimezoneOffset()))},this.endOfDay=function(dateStr,useTimezoneOffset){var date,dateInUTC,isAlreadyEndOfDay;return null==useTimezoneOffset&&(useTimezoneOffset=!0),date=new Date(dateStr),(isAlreadyEndOfDay=dateStr&&(dateStr.indexOf&&-1!==dateStr.indexOf("23:59:59.999Z")||dateStr.toISOString&&-1!==dateStr.toISOString().indexOf("23:59:59.999Z")))?date:(date.setHours(23,59,59,999),useTimezoneOffset?date:dateInUTC=new Date(date.valueOf()-6e4*date.getTimezoneOffset()))},this}).directive("vtFilter",function($rootScope,$location,DateTransform){return{restrict:"E",scope:{filters:"=filters"},templateUrl:config.path?config.path+"/vtex-ng-filter.html":"vtex-ng-filter.html",link:function($scope){var filter,filters,j,len,updateFiltersOnLocationSearch;for(filters=_.flatten($scope.filters),j=0,len=filters.length;len>j;j++)filter=filters[j],openFilters.hasOwnProperty(filter.rangeUrlTemplate)||(openFilters[filter.rangeUrlTemplate]=!1),moreOptionsShowFilters.hasOwnProperty(filter.rangeUrlTemplate)||(moreOptionsShowFilters[filter.rangeUrlTemplate]=!1);return $scope.openFilters=openFilters,$scope.moreOptionsShowFilters=moreOptionsShowFilters,$scope.clearAll=function(){var l,len1,results;for(results=[],l=0,len1=filters.length;len1>l;l++)filter=filters[l],results.push(filter.clearSelection());return results},$scope.filters.getAppliedFilters=function(){return _.filter(filters,function(f){return f.getSelectedItems().length>0})},$scope.filters.getAppliedItems=function(){return _.chain($scope.filters.getAppliedFilters()).map(function(f){return f.getSelectedItems()}).flatten().value()},updateFiltersOnLocationSearch=function(){var l,len1,results,searchQuery;for(results=[],l=0,len1=filters.length;len1>l;l++)filter=filters[l],searchQuery=$location.search()[filter.rangeUrlTemplate],searchQuery?(filter.setSelectedItems(decodeURIComponent(searchQuery)),results.push(filter.update())):results.push(filter.clearSelection());return results},updateFiltersOnLocationSearch(),$scope.$on("$locationChangeStart",function(){var k,ref,results,v;ref=$location.search(),results=[];for(k in ref)v=ref[k],results.push($location.search(k,decodeURIComponent(v)));return results}),$scope.$on("$locationChangeSuccess",function(){var queryFilters,selectedFilters;return queryFilters=_.map(filters,function(f){return $location.search()[f.rangeUrlTemplate]}).join(),selectedFilters=_.map(filters,function(f){return f.getSelectedItemsURL()}).join(),decodeURIComponent(queryFilters)!==selectedFilters?updateFiltersOnLocationSearch():void 0}),_.each(filters,function(filter,i){return $scope.$watch(function(scope){return _.flatten(scope.filters)[i].getSelectedItemsURL()},function(newValue,oldValue){var l,len1;if(newValue!==oldValue){for("date"===filter.type&&null!=filter.date&&(filters[i].date.from=filter.date.from,filters[i].date.to=filter.date.to,$rootScope.$$phase||$rootScope.$digest()),l=0,len1=filters.length;len1>l;l++)filter=filters[l],$location.search(filter.rangeUrlTemplate,filter.getSelectedItemsURL());return $location.search("page",1)}})})}}}).directive("vtFilterSummary",function(){return{restrict:"E",scope:{filters:"=filters"},templateUrl:config.path?config.path+"/vtex-ng-filter-summary.html":"vtex-ng-filter-summary.html"}}).directive("vtFilterButton",function(){return{restrict:"E",scope:{filters:"=filters",openFilters:"&"},templateUrl:config.path?config.path+"/vtex-ng-filter-button.html":"vtex-ng-filter-button.html"}}).provider("vtexNgFilter",{config:config,$get:function(filter){return filter}})}).call(this),angular.module("vtexNgFilter").run(function($templateCache){"use strict";$templateCache.put("vtex-ng-filter-button.html",'<a class="btn" href="javascript:void(0);" ng-click="openFilters()" ga-event="" ga-label="filter-open"><i class="icon-filter" ng-class="{ \'icon-blue\': filters.getAppliedItems().length > 0 }"></i>&nbsp; <span translate="">listing.filters</span> <span class="badge badge-info badge-corner" data-ng-show="filters.getAppliedItems().length > 0">{{ filters.getAppliedItems().length }}</span></a>'),$templateCache.put("vtex-ng-filter-summary.html",'<div class="filters-summary"><small ng-if="filters.length" ng-repeat="filter in filters.getAppliedFilters()"><span ng-repeat="item in filter.getSelectedItems()"><span class="label label-info"><span translate="">{{ item.name }}</span>&nbsp; <a href="javascript:void(0);" ng-click="filter.clearItem(item)"><i class="icon-remove-sign"></i></a></span>&nbsp;</span></small></div>'),$templateCache.put("vtex-ng-filter.html",'<div class="filters-block"><h3><span translate="">listing.filters</span> <button translate="" class="btn btn-small btn-clean-filters" ng-if="filters.getAppliedFilters().length" ng-click="clearAll()" ga-event="" ga-label="filter-clear-all">listing.clearAll</button></h3><div ng-repeat="group in filters track by group[0].groupName"><h3 class="group-header"><i ng-class="{ \'icon-calendar-empty\': group[0].groupName === \'date\',\n                           \'icon-exchange\': group[0].groupName === \'channel\',\n                            \'icon-refresh\': group[0].groupName === \'status\',\n                             \'icon-filter\': group[0].groupName === \'other\' }"></i> {{ (\'filters.groups.\' + group[0].groupName) | translate }}</h3><accordion close-others="true"><accordion-group is-open="openFilters[filter.rangeUrlTemplate]" ng-repeat="filter in group track by filter.name"><accordion-heading><span>{{ \'filters.\' + filter.rangeUrlTemplate | translate }}</span> <span ng-if="filter.getSelectedItems().length" class="badge badge-lightblue pull-right"><span ng-if="filter.type === \'multiple\' && filter.selectedCount">{{ filter.selectedCount }}</span> <span ng-if="filter.type !== \'multiple\'" class="fa fa-dot-circle-o"></span></span></accordion-heading><!-- DATE --><div ng-if="filter.type === \'date\'"><div class="pull-right"><label class="checkbox"><span translate="">filters.useMyTimezone</span><input type="checkbox" ng-model="filter.useTimezoneOffset" ng-change="filter.onUseTimezoneOffsetChange()" name="filter{{$index}}-use-timezone-offset">&nbsp; <small class="label label-info">{{ ::filter.currentTimezoneOffset.label }}</small></label></div><p><a href="javascript: void(0)" ng-click="filter.setDates()" translate="">listing.dates.today</a></p><p><a href="javascript: void(0)" ng-click="filter.setDates(-1, -1)" translate="">listing.dates.yesterday</a></p><p><a href="javascript: void(0)" ng-click="filter.setDates(-7)" translate="">listing.dates.thisWeek</a></p><p><a href="javascript: void(0)" ng-click="filter.setDates(0, 0, true)" translate="">listing.dates.currentMonth</a></p><p><a href="javascript: void(0)" ng-click="filter.setDates(-30)" translate="">listing.dates.thisMonth</a></p><p><a href="javascript: void(0)" ng-click="filter.clearSelection()" translate="">listing.dates.clearFilter</a></p><div class="input-append"><input type="text" ng-click="openFilters[filter.rangeUrlTemplate + \'Selector\'] = !openFilters[filter.rangeUrlTemplate + \'Selector\']" value="{{filter.dateRangeLabel()}}" readonly><a href="javascript:void(0);" class="add-on" ng-click="openFilters[filter.rangeUrlTemplate + \'Selector\'] = !openFilters[filter.rangeUrlTemplate + \'Selector\']"><i class="icon-calendar"></i></a></div><!-- DATEPICKERS --><div class="date-selectors" ng-if="openFilters[filter.rangeUrlTemplate + \'Selector\']"><div class="row-fluid"><div class="span5 control-group vtex-datepicker-container"><label for="date-from-{{ $index }}" translate="">listing.dates.from</label><input type="text" id="date-from-{{ $index }}" use-timezone-offset="filter.useTimezoneOffset" date-model="filter.date.from" period-of-day="start" vtex-datepicker=""></div><div class="span5 offset1 control-group vtex-datepicker-container"><label for="date-to-{{ $index }}" translate="">listing.dates.to</label><input type="text" id="date-to-{{ $index }}" use-timezone-offset="filter.useTimezoneOffset" date-model="filter.date.to" period-of-day="end" vtex-datepicker=""></div></div><!-- /row-fluid --></div><!-- /datepickers --></div><!-- /DATE --><div ng-if="filter.type !== \'date\'"><ul class="filter-list nav nav-pills nav-stacked"><!-- If 5 items, show all 5.\n								 If 6 items, show all 6.\n								 If 7 items, show 5 and button to show more. --><li ng-repeat="item in filter.items track by item.name" ng-if="(filter.items.length <= 6) || ($index < 5) || moreOptionsShowFilters[filter.rangeUrlTemplate]"><label class="checkbox" ng-if="filter.type == \'multiple\'"><input type="checkbox" name="{{filter.name}}" ng-model="item.selected" ng-change="filter.updateSelectedCount()"><span><span translate="">{{ item.name }}</span> {{ item.quantity ? \'(\' + item.quantity + \')\' : \'\' }}</span></label><label class="radio" ng-if="filter.type == \'single\'"><input type="radio" name="{{filter.name}}" ng-model="filter.selectedItem" ng-value="item"><span><span translate="">{{ item.name }}</span> {{ item.quantity ? \'(\' + item.quantity + \')\' : \'\' }}</span></label></li></ul><a href="javascript:void(0)" ng-click="moreOptionsShowFilters[filter.rangeUrlTemplate] = true" ng-if="filter.items.length > 6 && !moreOptionsShowFilters[filter.rangeUrlTemplate]" class="muted">{{ \'filters.moreOptionsShow\' | translate}} ({{ filter.items.length }})</a> <a href="javascript:void(0)" ng-click="moreOptionsShowFilters[filter.rangeUrlTemplate] = false" ng-if="filter.items.length > 6 && moreOptionsShowFilters[filter.rangeUrlTemplate]" class="muted">{{ \'filters.moreOptionsHide\' | translate}}</a> <button translate="" class="btn" ng-click="filter.clearSelection()" ng-show="filter.type === \'single\' && filter.selectedItem">search.clear</button></div></accordion-group></accordion></div></div>')});