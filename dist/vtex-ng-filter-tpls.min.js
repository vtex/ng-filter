(function(){var config,loadInitialFilter,moreOptionsShowFilters,openFilters,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};config={path:""},openFilters={},moreOptionsShowFilters={},loadInitialFilter=!0,angular.module("vtexNgFilter",[]).factory("Filter",function($rootScope,$location,$filter,DateTransform){return function(){function Filter(filter){var k,querystring,ref,v,offset,_this;for(k in null==filter&&(filter={}),this.setGroup=bind(this.setGroup,this),this.update=bind(this.update,this),this.confirmCheckboxesSelection=bind(this.confirmCheckboxesSelection,this),this.selectAll=bind(this.selectAll,this),this.clearSelection=bind(this.clearSelection,this),this.getSelectedItemsURL=bind(this.getSelectedItemsURL,this),this.getSelectedItems=bind(this.getSelectedItems,this),this.setSelectedItems=bind(this.setSelectedItems,this),this.updateSelectedCount=bind(this.updateSelectedCount,this),this.setInitialFilter=bind(this.setInitialFilter,this),filter)v=filter[k],this[k]=v;querystring=$location.search(),loadInitialFilter&&"creationDate,desc"===querystring.orderBy&&1===Object.keys(querystring).length&&this.setInitialFilter(),this.useTimezoneOffset=!1!==(ref=querystring.p_f_useUserTimezone)&&"false"!==ref,this.currentTimezoneOffset=(offset=(new Date).getTimezoneOffset()/60,{label:(0<=parseInt(offset)?"+":"")+offset+"h",value:offset}),this.onUseTimezoneOffsetChange=(_this=this,function(){return $location.search("p_f_useUserTimezone",_this.useTimezoneOffset)}),this.setGroup(),this.selectedCount=0,this.setDelivery=function(filter,item){return $location.search(filter.rangeUrlTemplate,item.url)},"date"===this.type&&(this.dateObjectCache={},function(_this){return function(date,propertyName){var ref1;return angular.isDefined(date)?_this[propertyName]=date:null!=(ref1=_this[propertyName])&&ref1}}(this),this.date={},this.today=DateTransform.endOfDay(new Date,this.useTimezoneOffset),this.setDates=function(_this){return function(option){var baseFrom,baseTo,dateFrom,dateTo;switch(_this.useTimezoneOffset?(baseFrom=moment(),baseTo=moment()):(baseFrom=moment.utc(),baseTo=moment.utc()),option){case"today":dateFrom=baseFrom.startOf("day"),dateTo=baseTo.endOf("day");break;case"yesterday":dateFrom=baseFrom.subtract(1,"day").startOf("day"),dateTo=baseTo.subtract(1,"day").endOf("day");break;case"week":dateFrom=baseFrom.subtract(7,"day"),dateTo=baseTo;break;case"current-month":dateFrom=baseFrom.startOf("month").startOf("day"),dateTo=baseTo.endOf("month").endOf("day");break;case"month":dateFrom=baseFrom.subtract(1,"month"),dateTo=baseTo}return _this.date={from:dateFrom.toDate(),to:dateTo.toDate()}}}(this),this.dateRangeLabel=function(_this){return function(){var diffInDays;return _this.date.from&&_this.date.to?DateTransform.startOfDay(_this.date.from,_this.useTimezoneOffset).toString()===DateTransform.startOfDay(new Date,_this.useTimezoneOffset).toString()?"listing.dates.today":moment(_this.date.from)===DateTransform.startOfDay(moment().add("d",-1),_this.useTimezoneOffset)&&moment(_this.date.to).toISOString()===DateTransform.endOfDay(moment().add("d",-1),_this.useTimezoneOffset).toISOString()?"listing.dates.yesterday":moment(_this.date.from).isSame(moment().startOf("month").toDate())&&moment(_this.date.to).isSame(moment().endOf("month").toDate())?"listing.dates.currentMonth":DateTransform.startOfDay(_this.date.to,_this.useTimezoneOffset).toISOString()===DateTransform.startOfDay(new Date,_this.useTimezoneOffset).toISOString()?-7===(diffInDays=moment(_this.date.from).diff(moment(_this.date.to),"days"))?"listing.dates.thisWeek":-30===diffInDays?"listing.dates.thisMonth":moment(_this.date.from).add("hours",moment().hours()).fromNow()+" "+$filter("translate")("listing.dates.untilToday"):moment(_this.date.from).add("hours",moment().hours()).fromNow()+" "+$filter("translate")("listing.dates.until")+" "+moment(_this.date.to).add("hours",moment().hours()).fromNow():"listing.dates.noRangeSelected"}}(this)),this.updateSelectedCount()}return Filter.prototype.setInitialFilter=function(useTimezoneOffset){var range,today;return loadInitialFilter=!1,null==useTimezoneOffset&&(useTimezoneOffset=!0),today=moment().add("d",0).toDate(),range={from:DateTransform.startOfDay(today,useTimezoneOffset),to:DateTransform.endOfDay(today,useTimezoneOffset)},$location.search("f_creationDate","creationDate:["+range.from.toISOString()+" TO "+range.to.toISOString()+"]")},Filter.prototype.updateSelectedCount=function(){var i,j,l,lastSelectedItemIndex,len,len1,ref,ref1,selectedItemIndex;if("date"===this.type)this.selectedCount=this.date.from&&this.date.to?1:0;else if("multiple"===this.type){for(i=j=0,len=(ref=this.items).length;j<len;i=++j)ref[i].selected&&(lastSelectedItemIndex=i);4<lastSelectedItemIndex&&(moreOptionsShowFilters[this.rangeUrlTemplate]=!0),this.selectedCount=_.filter(this.items,function(i){return i.selected}).length}else if("single"===this.type){for(i=l=0,len1=(ref1=this.items).length;l<len1;i=++l)ref1[i]===this.selectedItem&&(selectedItemIndex=i);4<selectedItemIndex&&(moreOptionsShowFilters[this.rangeUrlTemplate]=!0),this.selectedCount=this.selectedItem?1:0}return this.selectedCountLabel=this.selectedCount?"("+this.selectedCount+")":""},Filter.prototype.setSelectedItems=function(itemsAsSearchParameter){var date,item,items,j,len,ref,ref1;if("date"===this.type)date={from:(items=itemsAsSearchParameter.replace(this.name+":[","").replace("]","").split(" TO "))[0],to:items[1]},this.date=date;else if("multiple"===this.type)for(j=0,len=(ref=this.items).length;j<len;j++)(item=ref[j]).selected=(ref1=item.url,0<=indexOf.call(itemsAsSearchParameter.split(","),ref1));else"single"===this.type&&(this.selectedItem=_.find(this.items,function(i){return i.url===itemsAsSearchParameter}));return this.updateSelectedCount()},Filter.prototype.getSelectedItems=function(){var base,dateFrom,dateTo,item,j,len,ref,results,url;if("date"===this.type)return this.date.from&&this.date.to?(dateFrom="string"==typeof this.date.from?this.date.from:this.date.from.toISOString(),dateTo="string"==typeof this.date.to?this.date.to:this.date.to.toISOString(),url=this.name+":["+dateFrom+" TO "+dateTo+"]",(base=this.dateObjectCache)[url]||(base[url]={name:this.dateRangeLabel(),url:url}),[this.dateObjectCache[url]]):[];if("multiple"===this.type){for(results=[],j=0,len=(ref=this.items).length;j<len;j++)(item=ref[j]).selected&&results.push(item);return results}return"single"===this.type?this.selectedItem?[this.selectedItem]:[]:void 0},Filter.prototype.getSelectedItemsURL=function(){var selectedArray;return 0<(selectedArray=_.map(this.getSelectedItems(),function(i){return i.url})).length?selectedArray.join(","):null},Filter.prototype.clearItem=function(itemObject){var item,j,len,ref,ref1;if("date"===(ref=this.type)||"single"===ref)return this.clearSelection();if("multiple"===this.type){for(j=0,len=(ref1=this.items).length;j<len;j++)item=ref1[j],itemObject.url===item.url&&(item.selected=!1);return this.updateSelectedCount()}},Filter.prototype.clearSelection=function(){var j,len,ref;if("date"===this.type)this.date={};else if("multiple"===this.type)for(j=0,len=(ref=this.items).length;j<len;j++)ref[j].selected=!1;else"single"===this.type&&(this.selectedItem=null);return this.updateSelectedCount()},Filter.prototype.selectAll=function(){var j,len,ref;if("multiple"===this.type){for(j=0,len=(ref=this.items).length;j<len;j++)ref[j].selected=!0;return this.updateSelectedCount()}},Filter.prototype.confirmDateSelection=function(){return $rootScope.$broadcast("confirmChangeDate")},Filter.prototype.confirmCheckboxesSelection=function(){return $rootScope.$broadcast("confirmCheckboxesSelection")},Filter.prototype.update=function(filterJSON){var item,j,len,ref,ref1,updatedItem;for(null==filterJSON&&(filterJSON=this),j=0,len=(ref=this.items).length;j<len;j++)item=ref[j],(updatedItem=_.find(filterJSON.items,function(i){return i.name===item.name}))&&0===(null!=(ref1=this.getSelectedItems())?ref1.length:void 0)?item.quantity=updatedItem.quantity:item.quantity=0},Filter.prototype.setGroup=function(){var ref,ref1,ref2;return"creationDate"===(ref=this.name)||"authorizedDate"===ref||"ShippingEstimatedDate"===ref||"invoicedDate"===ref?this.groupName="date":"SalesChannelName"===(ref1=this.name)||"CallCenterOperatorName"===ref1||"SellerNames"===ref1||"UtmSource"===ref1||"affiliateId"===ref1||"MarketingTags"===ref1?this.groupName="channel":"StatusDescription"===(ref2=this.name)||"orderSituation"===ref2||"errorStatus"===ref2?this.groupName="status":this.groupName="other"},Filter}()}).service("DateTransform",function(){return this.startOfDay=function(dateStr,useTimezoneOffset){var date;return null==useTimezoneOffset&&(useTimezoneOffset=!0),date=new Date(dateStr),dateStr&&(dateStr.indexOf&&-1!==dateStr.indexOf("00:00:00.000Z")||dateStr.toISOString&&-1!==dateStr.toISOString().indexOf("00:00:00.000Z"))?date:(date.setHours(0,0,0,0),useTimezoneOffset?date:new Date(date.valueOf()-6e4*date.getTimezoneOffset()))},this.endOfDay=function(dateStr,useTimezoneOffset){var date;return null==useTimezoneOffset&&(useTimezoneOffset=!0),date=new Date(dateStr),dateStr&&(dateStr.indexOf&&-1!==dateStr.indexOf("23:59:59.999Z")||dateStr.toISOString&&-1!==dateStr.toISOString().indexOf("23:59:59.999Z"))?date:(date.setHours(23,59,59,999),useTimezoneOffset?date:new Date(date.valueOf()-6e4*date.getTimezoneOffset()))},this}).directive("vtFilter",function($rootScope,$location,DateTransform,$injector){return{restrict:"E",scope:{filters:"=filters",infoMessage:"=infoMessage"},templateUrl:config.path?config.path+"/vtex-ng-filter.html":"vtex-ng-filter.html",link:function($scope){var filter,filterTimeLimit,filters,j,len,updateFiltersOnLocationSearch;for($scope.translationIdsPrefix={status:"detail.state.",PaymentNames:"filters.PaymentNames."},j=0,len=(filters=_.flatten($scope.filters)).length;j<len;j++)filter=filters[j],moreOptionsShowFilters.hasOwnProperty(filter.rangeUrlTemplate)||(moreOptionsShowFilters[filter.rangeUrlTemplate]=!1);return $injector.has("filterTimeLimit")&&(filterTimeLimit=$injector.get("filterTimeLimit"))&&filterTimeLimit.value&&($scope.filterTimeLimitValue=!0),$scope.openFilters=openFilters,$scope.moreOptionsShowFilters=moreOptionsShowFilters,$scope.clearAll=function(){var l,len1,results;for(results=[],l=0,len1=filters.length;l<len1;l++)filter=filters[l],results.push(filter.clearSelection());return results},$scope.filters.getAppliedFilters=function(){return _.filter(filters,function(f){return 0<f.getSelectedItems().length})},$scope.filters.getAppliedItems=function(){return _.chain($scope.filters.getAppliedFilters()).map(function(f){return f.getSelectedItems()}).flatten().value()},(updateFiltersOnLocationSearch=function(){var encodedURI,l,len1,results,searchQuery;for(results=[],l=0,len1=filters.length;l<len1;l++)filter=filters[l],(searchQuery=$location.search()[filter.rangeUrlTemplate])?(encodedURI=encodeURIComponent(searchQuery),filter.setSelectedItems(decodeURIComponent(encodedURI)),results.push(filter.update())):results.push(filter.clearSelection());return results})(),$scope.$on("$locationChangeStart",function(){var encodedURI,k,ref,results,v;for(k in results=[],ref=$location.search())-1!==(v=ref[k]).toString().indexOf("%")&&(v=decodeURIComponent(v)),encodedURI=encodeURIComponent(v),results.push($location.search(k,decodeURIComponent(encodedURI)));return results}),$scope.$on("$locationChangeSuccess",function(){var encodedURI,queryFilters,selectedFilters;if(queryFilters=_.map(filters,function(f){return $location.search()[f.rangeUrlTemplate]}).join(),selectedFilters=_.map(filters,function(f){return f.getSelectedItemsURL()}).join(),encodedURI=encodeURIComponent(queryFilters),decodeURIComponent(encodedURI)!==selectedFilters)return updateFiltersOnLocationSearch()}),$scope.$on("confirmCheckboxesSelection",function(){return _.each(filters,function(filter,i){return $location.search(filter.rangeUrlTemplate,filter.getSelectedItemsURL())})}),_.each(filters,function(filter,i){return $scope.$watch(function(scope){return _.flatten(scope.filters)[i].getSelectedItemsURL()},function(newValue,oldValue){var l,len1;if(newValue!==oldValue){for("date"===filter.type&&null!=filter.date&&(filters[i].date.from=filter.date.from,filters[i].date.to=filter.date.to,$rootScope.$$phase||$rootScope.$digest()),l=0,len1=filters.length;l<len1;l++)("multiple"!==(filter=filters[l]).type||"multiple"===filter.type&&null===newValue)&&$location.search(filter.rangeUrlTemplate,filter.getSelectedItemsURL());return $location.search("page",1)}})})}}}).directive("vtFilterSummary",function(){return{restrict:"E",scope:{filters:"=filters"},templateUrl:config.path?config.path+"/vtex-ng-filter-summary.html":"vtex-ng-filter-summary.html"}}).directive("vtFilterButton",function(){return{restrict:"E",scope:{filters:"=filters",openFilters:"&"},templateUrl:config.path?config.path+"/vtex-ng-filter-button.html":"vtex-ng-filter-button.html"}}).provider("vtexNgFilter",{config:config,$get:function(filter){return filter}})}).call(this),angular.module("vtexNgFilter").run(function($templateCache){"use strict";$templateCache.put("vtex-ng-filter-button.html",'<a class="btn" href="javascript:void(0);" ng-click="openFilters()" ga-event ga-label="filter-open"><i class="icon-filter" ng-class="{ \'icon-blue\': filters.getAppliedItems().length > 0 }"></i>&nbsp; <span translate>listing.filters</span> <span class="badge badge-info badge-corner" data-ng-show="filters.getAppliedItems().length > 0">{{ filters.getAppliedItems().length }}</span></a>'),$templateCache.put("vtex-ng-filter-summary.html",'<div class="filters-summary"><small ng-if="filters.length" ng-repeat="filter in filters.getAppliedFilters()"><span ng-repeat="item in filter.getSelectedItems()"><span class="label label-info"><span ng-switch="filter.name"><span ng-switch-when="status" translate>{{ \'detail.state.\' + item.name }}</span> <span ng-switch-when="ShippingEstimatedDate" translate>{{ \'filters.group-date-deliver.\' + item.name }}</span> <span ng-switch-default translate>{{ item.name }}</span> </span>&nbsp; <a href="javascript:void(0);" ng-click="filter.clearItem(item)"><i class="icon-remove-sign"></i></a> </span>&nbsp;</span></small></div>'),$templateCache.put("vtex-ng-filter.html",'<div class="filters-block filters-container"><h3><span translate>listing.filters</span> <button translate class="btn btn-small btn-clean-filters" ng-if="filters.getAppliedFilters().length" ng-click="clearAll()" ga-event ga-label="filter-clear-all">listing.clearAll</button></h3><span ng-if="infoMessage" translate>{{ infoMessage }}</span><div ng-repeat="group in filters track by group[0].groupName"><h3 class="group-header" ng-if="group && group.length > 0"><i ng-class="{ \'icon-calendar-empty\': group[0].groupName === \'date\',\n                           \'icon-exchange\': group[0].groupName === \'channel\',\n                            \'icon-refresh\': group[0].groupName === \'status\',\n                             \'icon-filter\': group[0].groupName === \'other\' }"></i> {{ \'filters.groups.\' + group[0].groupName | translate }}</h3><accordion close-others="true"><accordion-group is-open="openFilters[filter.rangeUrlTemplate]" ng-repeat="filter in group track by filter.name"><accordion-heading><span>{{ \'filters.\' + filter.rangeUrlTemplate | translate }} </span><span ng-if="filter.getSelectedItems().length" class="badge badge-lightblue pull-right"><span ng-if="filter.type === \'multiple\' && filter.selectedCount">{{ filter.selectedCount }}</span> <span ng-if="filter.type !== \'multiple\'" class="fa fa-dot-circle-o"></span></span></accordion-heading>\x3c!-- DATE --\x3e<div ng-if="filter.type === \'date\'"><div class="pull-right"><label class="checkbox"><span translate>filters.useMyTimezone</span> <input type="checkbox" ng-model="filter.useTimezoneOffset" ng-change="filter.onUseTimezoneOffsetChange()" name="filter{{ $index }}-use-timezone-offset"> <small class="label label-info">{{ ::filter.currentTimezoneOffset.label }}</small></label></div><p><a ng-class="{ \'filter-active\' : filter.dateRangeLabel() === \'listing.dates.today\' }" href="javascript: void(0)" ng-click="filter.setDates(\'today\')" translate>listing.dates.today</a></p><p><a ng-class="{ \'filter-active\' : filter.dateRangeLabel() === \'listing.dates.yesterday\' }" href="javascript: void(0)" ng-click="filter.setDates(\'yesterday\')" translate>listing.dates.yesterday</a></p><p><a ng-class="{ \'filter-active\' : filter.dateRangeLabel() === \'listing.dates.thisWeek\' }" href="javascript: void(0)" ng-click="filter.setDates(\'week\')" translate>listing.dates.thisWeek</a></p><p><a ng-class="{ \'filter-active\' : filter.dateRangeLabel() === \'listing.dates.currentMonth\' }" href="javascript: void(0)" ng-click="filter.setDates(\'current-month\')" translate>listing.dates.currentMonth</a></p><p><a ng-class="{ \'filter-active\' : filter.dateRangeLabel() === \'listing.dates.thisMonth\' }" href="javascript: void(0)" ng-click="filter.setDates(\'month\')" translate>listing.dates.thisMonth</a></p><div class="input-append"><input type="text" ng-click="openFilters[filter.rangeUrlTemplate + \'Selector\'] = !openFilters[filter.rangeUrlTemplate + \'Selector\']" value="{{ filter.dateRangeLabel() | translate }}" readonly> <a href="javascript:void(0);" class="add-on" ng-click="openFilters[filter.rangeUrlTemplate + \'Selector\'] = !openFilters[filter.rangeUrlTemplate + \'Selector\']"><i class="icon-calendar"></i></a></div>\x3c!-- DATEPICKERS --\x3e<div class="date-selectors" ng-if="openFilters[filter.rangeUrlTemplate + \'Selector\']" ng-controller="DateTimePickerController"><div class="row-fluid control-group vtex-datepicker-container"><div class="span8"><datetime-range on-close="onCloseDateRange()" min-date="date.minDate" max-date="date.maxDate" start="date.tempFrom" end="date.tempTo"></datetime-range></div></div><div class="row-fluid row-info-range-limit" ng-if="filterTimeLimitValue"><div ng-if="!exceedRangeLimit"><i class="icon-info-sign icon-blue"></i> <span class="filter-time-limit" translate>search.date-range-limit</span></div><div ng-if="exceedRangeLimit" class="alert alert-error"><i class="icon-exclamation-sign"></i> <span translate>search.exceed-date-range-limit</span></div></div></div>\x3c!-- /DATEPICKERS --\x3e<div class="row-fluid row-selectors-actions"><div class="span5 action-container"><button class="btn left" ng-click="filter.clearSelection()" ng-show="filter.selectedCount" translate>search.clear</button></div><div class="span5 action-container offset1"><button class="btn pull-right btn-success" ng-click="filter.confirmDateSelection()" ng-show="openFilters[filter.rangeUrlTemplate + \'Selector\']" translate>search.confirm</button></div></div></div>\x3c!-- /DATE --\x3e<div ng-if="filter.type !== \'date\'"><ul class="filter-list nav nav-pills nav-stacked">\x3c!-- If 5 items, show all 5.\n\t\t\t\t\t\t\t\t If 6 items, show all 6.\n\t\t\t\t\t\t\t\t If 7 items, show 5 and button to show more. --\x3e<li ng-repeat="item in filter.items track by item.name" ng-if="(filter.items.length <= 6) || ($index < 5) || moreOptionsShowFilters[filter.rangeUrlTemplate]"><label class="checkbox" ng-if="filter.type == \'multiple\'"><input type="checkbox" name="{{ filter.name }}" ng-model="item.selected" ng-change="filter.updateSelectedCount()"> <span><span translate translate-default="{{ item.name }}">{{ translationIdsPrefix[filter.name] + item.name }}</span> {{ item.quantity ? \' (\' + item.quantity + \')\' : \'\' }}</span></label><label class="radio" ng-if="filter.type == \'single\' && filter.name != \'ShippingEstimatedDate\'"><input type="radio" name="{{ filter.name }}" ng-model="filter.selectedItem" ng-value="item"> <span><span translate>{{ item.name }}</span> {{ item.quantity ? \' (\' + item.quantity + \')\' : \'\' }}</span></label><p ng-if="filter.name == \'ShippingEstimatedDate\'"><a href="javascript:void(0)" ng-click="filter.setDelivery(filter, item)" ng-model="filter.selectedItem" ng-class="{ \'filter-active\' : filter.selectedItem.name === item.name }"><span><span ng-show="filter.name === \'ShippingEstimatedDate\'" translate>{{ \'filters.group-date-deliver.\' + item.name }} </span><span ng-hide="filter.name === \'ShippingEstimatedDate\'" translate>{{ item.name }} </span>{{ item.quantity ? \' (\' + item.quantity + \')\' : \'\' }}</span></a></p></li></ul><a href="javascript:void(0)" ng-click="moreOptionsShowFilters[filter.rangeUrlTemplate] = true" ng-if="filter.items.length > 6 && !moreOptionsShowFilters[filter.rangeUrlTemplate]" class="muted">{{ \'filters.moreOptionsShow\' | translate }} ({{ filter.items.length }}) </a><a href="javascript:void(0)" ng-click="moreOptionsShowFilters[filter.rangeUrlTemplate] = false" ng-if="filter.items.length > 6 && moreOptionsShowFilters[filter.rangeUrlTemplate]" class="muted">{{ \'filters.moreOptionsHide\' | translate }}</a><p><button translate class="btn" ng-click="filter.clearSelection()" ng-show="filter.selectedItem || filter.selectedCount">search.clear</button> <button class="btn left btn-primary" ng-click="filter.selectAll()" ng-if="filter.type == \'multiple\'" translate>search.selectall</button> <button class="btn pull-right btn-success" ng-if="(filter.selectedItem || filter.selectedCount) && filter.type == \'multiple\'" ng-click="filter.confirmCheckboxesSelection()" translate>search.confirm</button></p></div></accordion-group></accordion></div></div>')});