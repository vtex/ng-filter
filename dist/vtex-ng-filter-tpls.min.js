angular.module("vtexNgFilter",[]),function(){angular.module("vtexNgFilter").filter("toBoolean",function(){return function(input){return!!input}})}.call(this),function(){angular.module("vtexNgFilter").factory("DefaultIntervalFilter",function(){var DefaultIntervalFilter;return DefaultIntervalFilter=function(){function DefaultIntervalFilter(){return[{name:"today",interval:"[now-1d TO now]"},{name:"yesterday",interval:"[now-2d TO now-1d]"},{name:"thisWeek",interval:"[now-1w TO now]"},{name:"oneWeekAgo",interval:"[now-2w TO now-1w]"},{name:"twoWeeksAgo",interval:"[now-3w TO now-2w]"},{name:"thisMonth",interval:"[now-30d TO now]"},{name:"lastMonth",interval:"[now-60d TO now-30d]"}]}return DefaultIntervalFilter}()}).factory("TransactionGroup",function(TransactionFilter){var TransactionGroup;return TransactionGroup=function(){function TransactionGroup(){var arr;return arr={},arr.startDate=new TransactionFilter("startDate","startDate","date","date"),arr.authorizationDate=new TransactionFilter("authorizationDate","authorizationDate","date","date"),arr.commitmentDate=new TransactionFilter("commitmentDate","commitmentDate","date","date"),arr.cancelationDate=new TransactionFilter("cancelationDate","cancelationDate","date","date"),arr["payments.paymentSystemName"]=new TransactionFilter("paymentSystem","payments.paymentSystemName","multiple","paymentCondition"),arr["payments.installments"]=new TransactionFilter("installments","payments.installments","multiple","paymentCondition"),arr["payments.connectorName"]=new TransactionFilter("connectorName","payments.connectorName","multiple","channel"),arr["payments.antifraudImplementation"]=new TransactionFilter("antifraudImplementation","payments.antifraudImplementation","multiple","channel"),arr.salesChannel=new TransactionFilter("salesChannel","salesChannel","multiple","channel"),arr.status=new TransactionFilter("status","status","multiple","status"),arr["payments.refunds"]=new TransactionFilter("refunds","payments.refunds","multiple","status"),arr}return TransactionGroup}()}).factory("TransactionFilter",function(DefaultIntervalFilter){var FilterOption,TransactionFilter;return FilterOption=function(){function FilterOption(name,quantity,type,status,group){var i,intervals,len,option,range;if(option={name:name,quantity:quantity,active:status,group:group},"date"!==type)option.value=function(name){return"string"==typeof name&&name.indexOf(" ")>=0&&(name='"'+name+'"'),name}(name);else for(intervals=new DefaultIntervalFilter,i=0,len=intervals.length;len>i;i++)range=intervals[i],range.name===name&&(option.value=range.interval);return option}return FilterOption}(),TransactionFilter=function(){function TransactionFilter(name,url,type,group,range){var self;self=this,this.name=name,this.url=url,this.type=type,this.group=group,this.active=!1,this.options=[],"date"!==type||range?this.range=range:this.range=new DefaultIntervalFilter,this.clearOptions=function(){return self.options=_.map(self.options,function(o){return o.active=!1,o.quantity=0,o})},this.setOptions=function(name,quantity,status){var _active,i,len,newOption,option,ref,updatedOption;for(updatedOption=!1,_active=!1,ref=self.options,i=0,len=ref.length;len>i;i++)option=ref[i],_active=_active||option.active,name===option.name&&(option.quantity=quantity,option.active=status,updatedOption=option);return self.active=status||_active,updatedOption?updatedOption:(newOption=new FilterOption(name,quantity,self.type,status,group),self.options.push(newOption),newOption)}}return TransactionFilter}()})}.call(this),function(){angular.module("vtexNgFilter").service("vtFilterService",function($http,$location,$rootScope,TransactionGroup,DefaultIntervalFilter){var baseInterval,getDateRangeFilter,self,setFacetsQuery,transformSearch;return self=this,baseInterval=new DefaultIntervalFilter,getDateRangeFilter=function(date){var _d,arr,j,len,range,ref;for(_d=date.url+"->",arr=[],ref=date.range,j=0,len=ref.length;len>j;j++)range=ref[j],arr.push(""+range.name+range.interval);return _d+=arr.join(";")},setFacetsQuery=function(filters){var queries,querystring;return querystring="_facets=",queries=[],_.each(filters,function(f){switch(f.type){case"multiple":return queries.push(f.url);case"date":return queries.push(getDateRangeFilter(f))}}),querystring+=queries.join(",")},transformSearch=function(searchObj){var basicFilters,k,search,v;basicFilters=new TransactionGroup,search=[];for(k in searchObj)v=searchObj[k],basicFilters[k]&&search.push(k+"="+v);return search.join("&")},self.filters=new TransactionGroup,self.activeFilters={list:[]},self.updateQueryString=function(){var availableFilters,filter,j,key,len,option,querieName,querieValue,query,ref,ref1,results,url,value;query={},ref=self.filters;for(url in ref){for(filter=ref[url],query[url]=query[url]||[],ref1=filter.options,j=0,len=ref1.length;len>j;j++)option=ref1[j],option.active&&query[url].push(option.value);query[url].length?query[url]=query[url].join(" OR "):query[url]=null}availableFilters={};for(key in query)value=query[key],null!==value&&(availableFilters[key]=value);$rootScope.$emit("filterChanged",{filterValues:availableFilters}),results=[];for(querieName in query)querieValue=query[querieName],results.push($location.search(querieName,querieValue));return results},self.clearAllFilters=function(){return self.filters=_.each(self.filters,function(f){return f.active=!1,_.each(f.options,function(o){return o.active=!1})})},self.setFilters=function(endpoint,filters,search){var locationActiveFilters;return locationActiveFilters=self.getQueryStringFilters(search,filters),self.activeFilters.list=[],self.getAvailableFacets(endpoint,filters,search).then(function(res){return _.each(res,function(categoryOptions,categoryName){var activeFilterName,filterName,filterQuantity,j,len,option,ref,results,status;filters[categoryName].clearOptions(),results=[];for(filterName in categoryOptions){if(filterQuantity=categoryOptions[filterName],locationActiveFilters[categoryName])for(ref=locationActiveFilters[categoryName],j=0,len=ref.length;len>j&&(activeFilterName=ref[j],!(status=activeFilterName.indexOf(filterName)>=0?activeFilterName:void 0));j++);"multiple"===filters[categoryName].type&&(status=!!status),option=filters[categoryName].setOptions(filterName,filterQuantity,status),option.active?results.push(self.activeFilters.list.push(option)):results.push(void 0)}return results})})},self.getQueryStringFilters=function(search,filters){var interval,k,obj,v;obj={};for(k in search)v=search[k],filters[k]&&("date"===filters[k].type&&(interval=_.find(baseInterval,function(i){return i.interval===v}),v=interval.name),obj[k]=v.split(" OR "));return obj},self.getAvailableFacets=function(endpoint,filters,search){var url;return url=endpoint+"?"+setFacetsQuery(filters),transformSearch(search)&&(url+="&"+transformSearch(search)),$http.get(url).then(function(res){return res.data})},self})}.call(this),angular.module("vtexNgFilter").run(function($templateCache){"use strict";$templateCache.put("vtex-ng-filter-button.html",'<div class="uim-btn-filter" ng-class="{ \'uim-filter-checked\': activeFilters.list.length }"><button class="btn" ng-click="openFilterSidebar()"><i class="fa fa-filter"></i> <span class="uim-filter-count badge" ng-show="activeFilters.list.length">{{ activeFilters.list.length }}</span></button></div>'),$templateCache.put("vtex-ng-filter-summary.html",'<div class="filters-summary"><span ng-show="activeFilters.list.length" ng-repeat="filter in activeFilters.list" ng-if="filter.active"><button class="btn btn-xs btn-info" ng-click="disableFilter(filter)"><span translate="">{{ filter.name }}</span> <i class="fa fa-remove"></i></button>&nbsp;</span></div>'),$templateCache.put("vtex-ng-filter.html",'<div class="filters-block"><h3>{{ \'listing.filters\' | translate }} <button class="btn btn-small btn-clean-filters" ng-if="activeFilters.list.length" ng-click="clearAllFilters()" translate="">listing.clearAll</button></h3><div ng-repeat="(name, group) in groups"><h3 class="group-header"><i class="fa" ng-class="{ \'fa-credit-card\': name === \'paymentCondition\',\n                                \'fa-calendar-o\': name === \'date\',\n                                \'fa-exchange\': name === \'channel\',\n                                \'fa-refresh\': name === \'status\', }"></i> {{ (\'filters.groups.\' + name) | translate }}</h3><accordion close-others="true"><accordion-group ng-repeat="filter in group" ng-if="filter.options.length"><accordion-heading>{{ \'filters.\' + filter.name | translate }} <span class="label label-info pull-right" ng-if="filter.active"><i class="fa fa-dot-circle-o"></i></span></accordion-heading><ul class="filter-list nav nav-pills nav-stacked"><li ng-repeat="option in filter.options"><div ng-class="{ \'disabled\': !option.quantity,\n                             \'checkbox\': filter.type == \'multiple\',\n                             \'radio\': filter.type == \'date\' }"><label><input name="{{ filter.url }}" type="checkbox" ng-if="filter.type == \'multiple\'" ng-change="updateQueryString()" ng-model="option.active" ng-checked="option.active" ng-disabled="!option.quantity"><input name="{{ filter.url }}" type="radio" ng-if="filter.type == \'date\'" ng-change="updateQueryString()" ng-model="option.active" ng-value="option.name" ng-disabled="!option.quantity">{{ option.name | translate }} <span class="text-muted">({{ option.quantity }})</span></label></div></li></ul><button class="btn" ng-click="filter.clearSelection()" ng-show="filter.type === \'single\' && filter.selectedItem" translate="">search.clear</button></accordion-group></accordion></div></div>')}),function(){angular.module("vtexNgFilter").directive("vtFilter",function($rootScope,$location,vtFilterService){return{restrict:"E",scope:{endpoint:"=endpoint"},templateUrl:"vtex-ng-filter.html",link:function($scope){var endpoint,filters,services;return services=vtFilterService,filters=services.filters,endpoint=$scope.endpoint,$scope.groups=_.groupBy(filters,function(_f){return _f.group}),$scope.activeFilters=services.activeFilters,$scope.clearAllFilters=function(){return services.clearAllFilters(),services.updateQueryString(),!0},$scope.updateQueryString=services.updateQueryString,services.setFilters(endpoint,filters).then(function(data){var search;return search=$location.search(),Object.keys(search).length?services.setFilters(endpoint,filters,search):void 0}),$scope.$on("$locationChangeSuccess",function(){return services.setFilters(endpoint,filters,$location.search())})}}}).directive("vtFilterSummary",function(vtFilterService,$rootScope){return{restrict:"E",scope:!0,templateUrl:"vtex-ng-filter-summary.html",link:function($scope){var services;return services=vtFilterService,$scope.activeFilters=services.activeFilters,$scope.disableFilter=function(filter){return filter.active=!1,$rootScope.$emit("filterRemoved",{filter:filter,location:"summary"}),services.updateQueryString()}}}}).directive("vtFilterButton",function(vtFilterService){return{restrict:"E",scope:!0,templateUrl:"vtex-ng-filter-button.html",link:function($scope){return $scope.activeFilters=vtFilterService.activeFilters},controller:function($scope,$rootScope){return $scope.openFilterSidebar=function(){return $rootScope.sidebar.show("filters"),$rootScope.$emit("filterToggle",{status:"opened"})}}}})}.call(this);